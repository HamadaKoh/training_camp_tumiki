# シンプル負荷テストシミュレーション 要件定義書

## 概要

検証目的で作成するシンプルなGKE（Google Kubernetes Engine）負荷テストデモアプリケーション。ユーザーがボタンをクリックしてサーバーに負荷をかけ、Pod数の変化をリアルタイムで確認できる最小限のWebアプリケーション。

## ユーザストーリー

### ストーリー1: 基本的な負荷テスト体験

- **である** 開発者/学習者 **として**
- **私は** ボタンクリックでGKEの自動スケーリングを確認 **したい**
- **そうすることで** HPAの動作を直感的に理解できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは 負荷生成ボタンを表示 しなければならない
- REQ-002: システムは ボタンクリック時にサーバーに負荷リクエストを送信 しなければならない
- REQ-003: システムは 現在のPod数を表示 しなければならない
- REQ-004: システムは Pod数の変化をリアルタイムで更新 しなければならない

### 条件付き要件

- REQ-101: 負荷が発生している 場合、システムは 負荷レベルを表示 しなければならない
- REQ-102: Podがスケーリング中の 場合、システムは スケーリング状態を表示 しなければならない

### 制約要件

- REQ-401: システムは GKE環境で動作 しなければならない
- REQ-402: システムは HPAと連携 しなければならない
- REQ-403: バックエンドは TypeScriptまたはPython で実装 しなければならない
- REQ-404: データベースは JSON型を使用してはならない
- REQ-405: システムは Workload Identity を使用してGKE APIにアクセス しなければならない
- REQ-406: システムは GKE Autopilotモードに対応 しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: Pod数の更新は 5秒以内に画面に反映される必要がある
- NFR-002: ボタンクリックのレスポンスは 500ms以内である必要がある

### セキュリティ

- NFR-101: システムは 基本的なCORS設定を実装する必要がある
- NFR-102: システムは GKE APIへの直接アクセスを制限する必要がある
- NFR-103: システムは Workload Identityを使用して最小権限の原則に従う必要がある
- NFR-104: システムは Google Cloud Load Balancerを通じてHTTPS通信を行う必要がある

### ユーザビリティ

- NFR-201: システムは 操作方法が明確なUIを提供する必要がある
- NFR-202: システムは エラー時に分かりやすいメッセージを表示する必要がある

## エッジケース

### エラー処理

- EDGE-001: GKE APIへの接続が失敗した場合、エラーメッセージを表示する
- EDGE-002: サーバーエラーが発生した場合、ユーザーに通知する

### 境界値

- EDGE-101: Pod数が0の場合、適切に表示する
- EDGE-102: 同時に複数のリクエストがあった場合、適切に処理する

## 受け入れ基準

### 機能テスト

- [ ] ボタンをクリックするとサーバーにリクエストが送信される
- [ ] Pod数が画面に表示される
- [ ] 負荷によってPod数が増加する
- [ ] Pod数の変化がリアルタイムで反映される
- [ ] HPAが正しく動作する

### 非機能テスト

- [ ] Pod数更新が5秒以内に反映される
- [ ] ボタンクリックの応答が500ms以内
- [ ] エラー時に適切なメッセージが表示される
- [ ] GKE環境でデプロイできる

### 技術仕様テスト

- [ ] バックエンドがTypeScript/Pythonで実装されている
- [ ] データベースでJSON型が使用されていない
- [ ] 正規化されたDBスキーマが使用されている

## システム簡素化方針

### 削除された機能（元の要件から）

- 爆弾カウントダウン機能
- ゲーミフィケーション要素
- スコアボード・実績システム
- 複数ユーザー対応
- 音響効果
- 複雑なアニメーション
- モバイル最適化
- 認証機能
- KEDA連携（HPAのみ）

### 簡素化されたアーキテクチャ

- シンプルなフロントエンド（React基本構成）
- 単一バックエンドサービス（マイクロサービス不要）
- 最小限のデータベーススキーマ
- WebSocketの代わりにポーリング（必要に応じて）
- Redis不要（セッション管理なし）

### 技術スタック制約

- **フロントエンド**: React + TypeScript（基本構成）
- **バックエンド**: Node.js + TypeScript **または** Python + FastAPI
- **データベース**: PostgreSQL（JSON型禁止、正規化テーブルのみ）
- **インフラ**: GKE + HPA（KEDAなし）

## 最小限の実装範囲

### 必須機能のみ

1. 負荷生成ボタン
2. Pod数表示
3. 負荷レベル表示
4. HPA連携

### 必須画面のみ

1. メイン画面（ボタン＋Pod数表示）

### 必須API

1. `POST /api/load` - 負荷生成
2. `GET /api/metrics` - Pod数取得

## GKE固有の考慮事項

### インフラストラクチャ

- **クラスタータイプ**: GKE Autopilot推奨（運用負荷軽減）
- **ノードプール**: Autopilotでは自動管理
- **ネットワーク**: VPCネイティブクラスター使用
- **認証**: Workload Identity有効化

### デプロイメント

- **コンテナレジストリ**: Artifact Registry使用
- **CI/CD**: Cloud Build統合可能
- **モニタリング**: Cloud Monitoring/Logging統合

### コスト最適化

- **開発環境**: プリエンプティブルノード使用可能（Standardモードの場合）
- **本番環境**: Autopilotで自動最適化
- **スケーリング**: HPAによる適切なリソース配分